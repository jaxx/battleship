<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Battleship</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/site.css" rel="stylesheet">
  </head>
  <body>
    <div class="upgrade-alert alert alert-success alert-dismissible" style="display: none;">
      <button type="button" class="close" data-dismiss="alert">&times</button>
      <strong>Server Upgrade.</strong>
      Battleship server was upgraded to version <span id="server-version">1</span>.
      <a id="server-upgrade" href="#">Refresh page</a> to take advantage of latest features.
    </div>
    <div class="server-closed-alert alert alert-danger alert-dismissible" style="display: none;">
      <button type="button" class="close" data-dismiss="alert">&times</button>
      <strong>Server Closed.</strong> Thank You! Come again!
    </div>
    <div id="usernameModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Please enter username</h4>
          </div>
          <div class="modal-body">
            <label for="username" class="sr-only">Username</label>
            <input type="text" id="username" class="form-control" placeholder="Username" required autofocus>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Let's play</button>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-4">
          <div class="board-container">
            <div><h3>Your board</h3></div>
            <div>
              <table border="1">
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="board-container">
            <div><h3>Opponents board</h3></div>
            <div>
              <table border="1">
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div id="chat-container" style="height: auto; max-height: 180px; overflow-x: hidden;">
            <ul id="messages" class="list-group">
            </ul>
          </div>
          <form action="">
            <div class="input-group">
              <input id="m" type="text" class="form-control" autocomplete="off" />
              <span class="input-group-btn">
                <button class="btn btn-default" type="submit">Send</button>
              </span>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script>
        var socket = io();

        $('#server-upgrade').on('click', function() {
          location.reload();
        });

        $('form').submit(function() {
          var msg = $('#m').val();
          if ($.trim(msg)) {
            socket.emit('chat message', msg);
            $('#m').val('');
          }
          return false;
        });

        var entityMap = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': '&quot;',
          "'": '&#39;'
        };

        function escapeHtml(string) {
          return String(string).replace(/[&<>"']/g, function (s) {
            return entityMap[s];
          });
        }

        socket.on('chat message', function(msg) {
          if ($.trim(msg)) {
            msg = escapeHtml(msg);
            msg = msg.replace(/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g, function(m) {
              return '<a href="' + m + '" target="_blank">' + m + '</a>';
            });
            msg = msg.replace(/\(\w+\)/g, function(m) {
              switch (m) {
                case '(monkey)': return '<img alt="' + m + '" src="https://az705183.vo.msecnd.net/onlinesupportmedia/onlinesupport/media/skype/screenshots/fa12330/emoticons/monkey_80_anim_gif.gif" />';
                default: return m;
              }
            })
            $('#messages').append($('<li class="list-group-item">').html(msg));
            var $messages = $('#messages');
            $messages.parent().animate({ scrollTop: $messages.parent()[0].scrollHeight }, "slow");
          }
        });

        socket.on('server closed', function() {
          $('.upgrade-alert').hide('slow');
          $('.server-closed-alert').show('slow');
        });

        socket.on('server version', function(version) {
          $('.server-closed-alert').hide('slow');
          var currentVersion = $('body').attr('data-battleship-version');
          if (!currentVersion) {
            $('body').attr('data-battleship-version', version);
          } else if (currentVersion != version) {
            $('#server-version').text(version);
            $('.upgrade-alert').show('slow');
          }
        });

        $(window).on('load', function() {
          $('#usernameModal').modal({
            backdrop: 'static',
            keyboard: false
          });
        }).load()

        $(window).on('resize', function() {
          $("#chat-container").height($(this).height() - 100);
          $("#chat-container").css('max-height', $(this).height() - 100);
        }).resize()
    </script>
  </body>
</html>